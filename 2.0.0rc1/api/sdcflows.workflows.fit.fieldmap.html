

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>sdcflows.workflows.fit.fieldmap module &mdash; sdcflows 2.0.1.dev50 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/banner.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="sdcflows.workflows.fit.pepolar module" href="sdcflows.workflows.fit.pepolar.html" />
    <link rel="prev" title="sdcflows.workflows.fit package" href="sdcflows.workflows.fit.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> sdcflows
          

          
          </a>

          
            
            
              <div class="version">
                2.0.1.dev50
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../api.html">Library API (application program interface)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="sdcflows.fieldmaps.html">sdcflows.fieldmaps module</a></li>
<li class="toctree-l2"><a class="reference internal" href="sdcflows.interfaces.html">sdcflows.interfaces package</a></li>
<li class="toctree-l2"><a class="reference internal" href="sdcflows.utils.html">sdcflows.utils package</a></li>
<li class="toctree-l2"><a class="reference internal" href="sdcflows.viz.html">sdcflows.viz package</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="sdcflows.workflows.html">sdcflows.workflows package</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="sdcflows.workflows.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="sdcflows.workflows.apply.html">sdcflows.workflows.apply package</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="sdcflows.workflows.fit.html">sdcflows.workflows.fit package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="sdcflows.workflows.html#submodules">Submodules</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../changes.html">What’s new?</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">sdcflows</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../api.html">Library API (application program interface)</a> &raquo;</li>
        
          <li><a href="sdcflows.workflows.html">sdcflows.workflows package</a> &raquo;</li>
        
          <li><a href="sdcflows.workflows.fit.html">sdcflows.workflows.fit package</a> &raquo;</li>
        
      <li>sdcflows.workflows.fit.fieldmap module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/api/sdcflows.workflows.fit.fieldmap.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  


    
    



    <p class="scv-banner scv-sphinx_rtd_theme"><a href="../../master/api/sdcflows.workflows.fit.fieldmap.html"><b>Warning:</b> This document is for an old version of sdcflows. The main version is master.</a></p>
<section id="module-sdcflows.workflows.fit.fieldmap">
<span id="sdcflows-workflows-fit-fieldmap-module"></span><h1>sdcflows.workflows.fit.fieldmap module<a class="headerlink" href="#module-sdcflows.workflows.fit.fieldmap" title="Permalink to this headline">¶</a></h1>
<p>Processing phase-difference and <em>directly measured</em> <span class="math notranslate nohighlight">\(B_0\)</span> maps.</p>
<section id="theory">
<h2>Theory<a class="headerlink" href="#theory" title="Permalink to this headline">¶</a></h2>
<p>The displacement suffered by every voxel along the phase-encoding (PE) direction
can be derived from Eq. (2) of <a class="reference internal" href="#hutton2002" id="id1"><span>[Hutton2002]</span></a>:</p>
<div class="math notranslate nohighlight">
\[\Delta_\text{PE} (i, j, k) = \gamma \cdot \Delta B_0 (i, j, k) \cdot T_\text{ro},
\label{eq:fieldmap-1}\tag{1}\]</div>
<p>where
<span class="math notranslate nohighlight">\(\Delta_\text{PE} (i, j, k)\)</span> is the <em>voxel-shift map</em> (VSM) along the <em>PE</em> direction,
<span class="math notranslate nohighlight">\(\gamma\)</span> is the gyromagnetic ratio of the H proton in Hz/T
(<span class="math notranslate nohighlight">\(\gamma = 42.576 \cdot 10^6 \, \text{Hz} \cdot \text{T}^\text{-1}\)</span>),
<span class="math notranslate nohighlight">\(\Delta B_0 (i, j, k)\)</span> is the <em>fieldmap variation</em> in T (Tesla), and
<span class="math notranslate nohighlight">\(T_\text{ro}\)</span> is the readout time of one slice of the EPI dataset
we want to correct for distortions.</p>
<p>Let <span class="math notranslate nohighlight">\(V\)</span> represent the «<em>fieldmap in Hz</em>» (or equivalently,
«<em>voxel-shift-velocity map</em>» as Hz are equivalent to voxels/s), with
<span class="math notranslate nohighlight">\(V(i,j,k) = \gamma \cdot \Delta B_0 (i, j, k)\)</span>, then, introducing
the voxel zoom along the phase-encoding direction, <span class="math notranslate nohighlight">\(s_\text{PE}\)</span>,
we obtain the nonzero component of the associated displacements field
<span class="math notranslate nohighlight">\(\Delta D_\text{PE} (i, j, k)\)</span> that unwarps the target EPI dataset:</p>
<div class="math notranslate nohighlight">
\[\Delta D_\text{PE} (i, j, k) = V(i, j, k) \cdot T_\text{ro} \cdot s_\text{PE}.
\label{eq:fieldmap-2}\tag{2}\]</div>
</section>
<section id="direct-b0-mapping-sequences">
<span id="sdc-direct-b0"></span><h2>Direct B0 mapping sequences<a class="headerlink" href="#direct-b0-mapping-sequences" title="Permalink to this headline">¶</a></h2>
<p>Some MR schemes such as <abbr title="spiral-echo imaging">SEI</abbr> can directly
reconstruct an estimate of <em>the fieldmap in Hz</em>, <span class="math notranslate nohighlight">\(V(i,j,k)\)</span>.
These <em>fieldmaps</em> are described with more detail <a class="reference external" href="https://cni.stanford.edu/wiki/GE_Processing#Fieldmaps">here</a>.</p>
<p>This corresponds to <a class="reference external" href="https://bids-specification.readthedocs.io/en/latest/04-modality-specific-files/01-magnetic-resonance-imaging-data.html#case-3-direct-field-mapping">this section of the BIDS specification</a>.</p>
</section>
<section id="phase-difference-b0-estimation">
<span id="sdc-phasediff"></span><h2>Phase-difference B0 estimation<a class="headerlink" href="#phase-difference-b0-estimation" title="Permalink to this headline">¶</a></h2>
<p>The fieldmap variation in T, <span class="math notranslate nohighlight">\(\Delta B_0 (i, j, k)\)</span>, that is necessary to obtain
<span class="math notranslate nohighlight">\(\Delta_\text{PE} (i, j, k)\)</span> in Eq. <span class="math notranslate nohighlight">\(\eqref{eq:fieldmap-1}\)</span> can be
calculated from two subsequient <abbr title="Gradient-Recalled Echo">GRE</abbr> echoes,
via eq. (1) of <a class="reference internal" href="#hutton2002" id="id2"><span>[Hutton2002]</span></a>:</p>
<div class="math notranslate nohighlight">
\[\Delta B_0 (i, j, k) = \frac{\Delta \Theta (i, j, k)}{2\pi \cdot \gamma \, \Delta\text{TE}},
\label{eq:fieldmap-3}\tag{3}\]</div>
<p>where
<span class="math notranslate nohighlight">\(\Delta \Theta (i, j, k)\)</span> is the phase-difference map in radians,
and <span class="math notranslate nohighlight">\(\Delta\text{TE}\)</span> is the elapsed time between the two GRE echoes.</p>
<p>For simplicity, the «<em>voxel-shift-velocity map</em>» <span class="math notranslate nohighlight">\(V(i,j,k)\)</span>, which we
can introduce in Eq. <span class="math notranslate nohighlight">\(\eqref{eq:fieldmap-2}\)</span> to directly obtain
the displacements field, can be obtained as:</p>
<div class="math notranslate nohighlight">
\[V(i, j, k) = \frac{\Delta \Theta (i, j, k)}{2\pi \cdot \Delta\text{TE}}.
\label{eq:fieldmap-4}\tag{4}\]</div>
<p>This calculation is further complicated by the fact that <span class="math notranslate nohighlight">\(\Theta_i\)</span>
(and therfore, <span class="math notranslate nohighlight">\(\Delta \Theta\)</span>) are clipped (or <em>wrapped</em>) within
the range <span class="math notranslate nohighlight">\([0 \dotsb 2\pi )\)</span>.
It is necessary to find the integer number of offsets that make a region
continuously smooth with its neighbors (<em>phase-unwrapping</em>, <a class="reference internal" href="#jenkinson2003" id="id3"><span>[Jenkinson2003]</span></a>).</p>
<p>This corresponds to <a class="reference external" href="https://bids-specification.readthedocs.io/en/latest/04-modality-specific-files/01-magnetic-resonance-imaging-data.html#two-phase-images-and-two-magnitude-images">this section of the BIDS specification</a>.
Some scanners produce one <code class="docutils literal notranslate"><span class="pre">phasediff</span></code> map, where the drift between the two echos has
already been calulated (see <a class="reference external" href="https://bids-specification.readthedocs.io/en/latest/04-modality-specific-files/01-magnetic-resonance-imaging-data.html#case-1-phase-difference-map-and-at-least-one-magnitude-image">the corresponding section of BIDS</a>).</p>
<p class="rubric">References</p>
<dl class="citation">
<dt class="label" id="hutton2002"><span class="brackets">Hutton2002</span><span class="fn-backref">(<a href="#id1">1</a>,<a href="#id2">2</a>)</span></dt>
<dd><p>Hutton et al., Image Distortion Correction in fMRI: A Quantitative
Evaluation, NeuroImage 16(1):217-240, 2002. doi:<a class="reference external" href="https://doi.org/10.1006/nimg.2001.1054">10.1006/nimg.2001.1054</a>.</p>
</dd>
<dt class="label" id="jenkinson2003"><span class="brackets">Jenkinson2003</span><span class="fn-backref">(<a href="#id3">1</a>,<a href="#id4">2</a>)</span></dt>
<dd><p>Jenkinson, M. (2003) Fast, automated, N-dimensional phase-unwrapping
algorithm. MRM 49(1):193-197. doi:<a class="reference external" href="https://doi.org/10.1002/mrm.10354">10.1002/mrm.10354</a>.</p>
</dd>
</dl>
<dl class="function">
<dt id="sdcflows.workflows.fit.fieldmap.init_fmap_wf">
<code class="sig-prename descclassname">sdcflows.workflows.fit.fieldmap.</code><code class="sig-name descname">init_fmap_wf</code><span class="sig-paren">(</span><em class="sig-param">omp_nthreads=1</em>, <em class="sig-param">sloppy=False</em>, <em class="sig-param">debug=False</em>, <em class="sig-param">mode='phasediff'</em>, <em class="sig-param">name='fmap_wf'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sdcflows/workflows/fit/fieldmap.html#init_fmap_wf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#sdcflows.workflows.fit.fieldmap.init_fmap_wf" title="Permalink to this definition">¶</a></dt>
<dd><p>Estimate the fieldmap based on a field-mapping MRI acquisition.</p>
<p>Estimates the fieldmap using either one phase-difference map or
image and one or more
magnitude images corresponding to two or more <abbr title="Gradient Echo sequence">GRE</abbr>
acquisitions.</p>
<p>When we have a sequence that directly measures the fieldmap,
we just need to mask it (using the corresponding magnitude image)
to remove the noise in the surrounding air region, and ensure that
units are Hz.</p>
<dl>
<dt>Workflow Graph</dt><dd><figure class="align-default">
<img alt="../_images/sdcflows-workflows-fit-fieldmap-1.png" src="../_images/sdcflows-workflows-fit-fieldmap-1.png" />
</figure>
<p>(<a class="reference external" href="../api/sdcflows-workflows-fit-fieldmap-1.py">Source code</a>, <a class="reference external" href="../api/sdcflows-workflows-fit-fieldmap-1.png">png</a>, <a class="reference external" href="../api/sdcflows-workflows-fit-fieldmap-1.svg">svg</a>, <a class="reference external" href="../api/sdcflows-workflows-fit-fieldmap-1.pdf">pdf</a>)</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>omp_nthreads</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>) – Maximum number of threads an individual process may use.</p></li>
<li><p><strong>sloppy</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a>) – Whether a fast but less accurate correction should be applied.</p></li>
<li><p><strong>debug</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a>) – Run in debug mode</p></li>
<li><p><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a>) – Unique name of this workflow.</p></li>
</ul>
</dd>
<dt class="field-even">Inputs</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>magnitude</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">list</span></code></a> of <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a>) – Path to the corresponding magnitude image for anatomical reference.</p></li>
<li><p><strong>fieldmap</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">list</span></code></a> of <code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple`(:obj:`str</span></code>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dict</span></code></a>)) – Path to the fieldmap acquisition (<code class="docutils literal notranslate"><span class="pre">*_fieldmap.nii[.gz]</span></code> of BIDS).</p></li>
</ul>
</dd>
<dt class="field-odd">Outputs</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fmap</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a>) – Path to the estimated fieldmap.</p></li>
<li><p><strong>fmap_ref</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a>) – Path to a preprocessed magnitude image reference.</p></li>
<li><p><strong>fmap_coeff</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a> or <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">list</span></code></a> of <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a>) – The path(s) of the B-Spline coefficients supporting the fieldmap.</p></li>
<li><p><strong>fmap_mask</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a>) – Path to a binary brain mask corresponding to the <code class="docutils literal notranslate"><span class="pre">fmap</span></code> and <code class="docutils literal notranslate"><span class="pre">fmap_ref</span></code>
pair.</p></li>
<li><p><strong>method</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a>) – Short description of the estimation method that was run.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="sdcflows.workflows.fit.fieldmap.init_magnitude_wf">
<code class="sig-prename descclassname">sdcflows.workflows.fit.fieldmap.</code><code class="sig-name descname">init_magnitude_wf</code><span class="sig-paren">(</span><em class="sig-param">omp_nthreads</em>, <em class="sig-param">name='magnitude_wf'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sdcflows/workflows/fit/fieldmap.html#init_magnitude_wf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#sdcflows.workflows.fit.fieldmap.init_magnitude_wf" title="Permalink to this definition">¶</a></dt>
<dd><p>Prepare the magnitude part of <abbr title="gradient-recalled echo">GRE</abbr> fieldmaps.</p>
<p>Average (if not done already) the magnitude part of the
<abbr title="gradient recalled echo">GRE</abbr> images, run N4 to
correct for B1 field nonuniformity, and skull-strip the
preprocessed magnitude.</p>
<dl>
<dt>Workflow Graph</dt><dd><figure class="align-default">
<img alt="../_images/sdcflows-workflows-fit-fieldmap-2.png" src="../_images/sdcflows-workflows-fit-fieldmap-2.png" />
</figure>
<p>(<a class="reference external" href="../api/sdcflows-workflows-fit-fieldmap-2.py">Source code</a>, <a class="reference external" href="../api/sdcflows-workflows-fit-fieldmap-2.png">png</a>, <a class="reference external" href="../api/sdcflows-workflows-fit-fieldmap-2.svg">svg</a>, <a class="reference external" href="../api/sdcflows-workflows-fit-fieldmap-2.pdf">pdf</a>)</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>omp_nthreads</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>) – Maximum number of threads an individual process may use</p></li>
<li><p><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a>) – Name of workflow (default: <code class="docutils literal notranslate"><span class="pre">magnitude_wf</span></code>)</p></li>
</ul>
</dd>
<dt class="field-even">Inputs</dt>
<dd class="field-even"><p><strong>magnitude</strong> (<a class="reference external" href="https://docs.python.org/3/library/os.html#os.PathLike" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">os.PathLike</span></code></a>) – Path to the corresponding magnitude path(s).</p>
</dd>
<dt class="field-odd">Outputs</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fmap_ref</strong> (<a class="reference external" href="https://docs.python.org/3/library/os.html#os.PathLike" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">os.PathLike</span></code></a>) – Path to the fieldmap reference calculated in this workflow.</p></li>
<li><p><strong>fmap_mask</strong> (<a class="reference external" href="https://docs.python.org/3/library/os.html#os.PathLike" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">os.PathLike</span></code></a>) – Path to a binary brain mask corresponding to the reference above.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="sdcflows.workflows.fit.fieldmap.init_phdiff_wf">
<code class="sig-prename descclassname">sdcflows.workflows.fit.fieldmap.</code><code class="sig-name descname">init_phdiff_wf</code><span class="sig-paren">(</span><em class="sig-param">omp_nthreads</em>, <em class="sig-param">debug=False</em>, <em class="sig-param">name='phdiff_wf'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sdcflows/workflows/fit/fieldmap.html#init_phdiff_wf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#sdcflows.workflows.fit.fieldmap.init_phdiff_wf" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate a <span class="math notranslate nohighlight">\(B_0\)</span> field from consecutive-phases and phase-difference maps.</p>
<p>This workflow preprocess phase-difference maps (or generates the phase-difference
map should two <code class="docutils literal notranslate"><span class="pre">phase1</span></code>/<code class="docutils literal notranslate"><span class="pre">phase2</span></code> be provided at the input), and generates
an image equivalent to BIDS’s <code class="docutils literal notranslate"><span class="pre">fieldmap</span></code> that can be processed with the
general fieldmap workflow.</p>
<p>Besides phase2 - phase1 subtraction, the core of this particular workflow relies
in the phase-unwrapping with FSL PRELUDE <a class="reference internal" href="#jenkinson2003" id="id4"><span>[Jenkinson2003]</span></a>.
FSL PRELUDE takes wrapped maps in the range 0 to 6.28, <a class="reference external" href="https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/FUGUE/Guide#Step_2_-_Getting_.28wrapped.29_phase_in_radians">as per the user guide</a>.</p>
<p>For the phase-difference maps, recentering back to <span class="math notranslate nohighlight">\([-\pi \dotsb \pi )\)</span>
is necessary.
After some massaging and with the scaling of the echo separation factor
<span class="math notranslate nohighlight">\(\Delta \text{TE}\)</span>, the phase-difference maps are converted into
an actual <span class="math notranslate nohighlight">\(B_0\)</span> map in Hz units.</p>
<dl>
<dt>Workflow Graph</dt><dd><figure class="align-default">
<img alt="../_images/sdcflows-workflows-fit-fieldmap-3.png" src="../_images/sdcflows-workflows-fit-fieldmap-3.png" />
</figure>
<p>(<a class="reference external" href="../api/sdcflows-workflows-fit-fieldmap-3.py">Source code</a>, <a class="reference external" href="../api/sdcflows-workflows-fit-fieldmap-3.png">png</a>, <a class="reference external" href="../api/sdcflows-workflows-fit-fieldmap-3.svg">svg</a>, <a class="reference external" href="../api/sdcflows-workflows-fit-fieldmap-3.pdf">pdf</a>)</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>omp_nthreads</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>) – Maximum number of threads an individual process may use</p></li>
<li><p><strong>debug</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a>) – Run in debug mode</p></li>
<li><p><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a>) – Name of workflow (default: <code class="docutils literal notranslate"><span class="pre">phdiff_wf</span></code>)</p></li>
</ul>
</dd>
<dt class="field-even">Inputs</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>magnitude</strong> (<a class="reference external" href="https://docs.python.org/3/library/os.html#os.PathLike" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">os.PathLike</span></code></a>) – A reference magnitude image preprocessed elsewhere.</p></li>
<li><p><strong>phase</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">list</span></code></a> of <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple</span></code></a> of (<a class="reference external" href="https://docs.python.org/3/library/os.html#os.PathLike" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">os.PathLike</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dict</span></code></a>)) – List containing one GRE phase-difference map with its corresponding metadata
(requires <code class="docutils literal notranslate"><span class="pre">EchoTime1</span></code> and <code class="docutils literal notranslate"><span class="pre">EchoTime2</span></code>), or the phase maps for the two
subsequent echoes, with their metadata (requires <code class="docutils literal notranslate"><span class="pre">EchoTime</span></code>).</p></li>
<li><p><strong>mask</strong> (<a class="reference external" href="https://docs.python.org/3/library/os.html#os.PathLike" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">os.PathLike</span></code></a>) – A brain mask calculated from the magnitude image.</p></li>
</ul>
</dd>
<dt class="field-odd">Outputs</dt>
<dd class="field-odd"><p><strong>fieldmap</strong> (<a class="reference external" href="https://docs.python.org/3/library/os.html#os.PathLike" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">os.PathLike</span></code></a>) – The estimated fieldmap in Hz.</p>
</dd>
</dl>
</dd></dl>

</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="sdcflows.workflows.fit.pepolar.html" class="btn btn-neutral float-right" title="sdcflows.workflows.fit.pepolar module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="sdcflows.workflows.fit.html" class="btn btn-neutral float-left" title="sdcflows.workflows.fit package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, The NiPreps developers.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: 2.0.0rc1
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Tags</dt>
            <dd><a href="../../1.0.0/index.html">1.0.0</a></dd>
            <dd><a href="../../1.0.0rc1/index.html">1.0.0rc1</a></dd>
            <dd><a href="../../1.0.1/index.html">1.0.1</a></dd>
            <dd><a href="../../1.0.2/index.html">1.0.2</a></dd>
            <dd><a href="../../1.0.3/index.html">1.0.3</a></dd>
            <dd><a href="../../1.0.4/index.html">1.0.4</a></dd>
            <dd><a href="../../1.0.5/index.html">1.0.5</a></dd>
            <dd><a href="../../1.0.6/index.html">1.0.6</a></dd>
            <dd><a href="../../1.1.0/index.html">1.1.0</a></dd>
            <dd><a href="../../1.2.0/index.html">1.2.0</a></dd>
            <dd><a href="../../1.2.1/index.html">1.2.1</a></dd>
            <dd><a href="../../1.2.2/index.html">1.2.2</a></dd>
            <dd><a href="../../1.2.3/index.html">1.2.3</a></dd>
            <dd><a href="../../1.3.0/index.html">1.3.0</a></dd>
            <dd><a href="../../1.3.1/index.html">1.3.1</a></dd>
            <dd><a href="../../1.3.2/index.html">1.3.2</a></dd>
            <dd><a href="../../1.3.3/index.html">1.3.3</a></dd>
            <dd><a href="../../1.4.0rc0/api/sdcflows.workflows.fit.fieldmap.html">1.4.0rc0</a></dd>
            <dd><a href="../../2.0.0/api/sdcflows.workflows.fit.fieldmap.html">2.0.0</a></dd>
            <dd><a href="sdcflows.workflows.fit.fieldmap.html">2.0.0rc1</a></dd>
            <dd><a href="../../2.0.0rc2/api/sdcflows.workflows.fit.fieldmap.html">2.0.0rc2</a></dd>
            <dd><a href="../../2.0.0rc3/api/sdcflows.workflows.fit.fieldmap.html">2.0.0rc3</a></dd>
            <dd><a href="../../2.0.0rc4/api/sdcflows.workflows.fit.fieldmap.html">2.0.0rc4</a></dd>
            <dd><a href="../../2.0.0rc5/api/sdcflows.workflows.fit.fieldmap.html">2.0.0rc5</a></dd>
            <dd><a href="../../2.0.1/api/sdcflows.workflows.fit.fieldmap.html">2.0.1</a></dd>
        </dl>
        <dl>
            <dt>Branches</dt>
            <dd><a href="../../dev_1.4.0/api/sdcflows.workflows.fit.fieldmap.html">dev/1.4.0</a></dd>
            <dd><a href="../../enh_outputnode-method/api/sdcflows.workflows.fit.fieldmap.html">enh/outputnode-method</a></dd>
            <dd><a href="../../enh_pepolar-double-check/api/sdcflows.workflows.fit.fieldmap.html">enh/pepolar-double-check</a></dd>
            <dd><a href="../../feat_new-api/index.html">feat/new-api</a></dd>
            <dd><a href="../../fix_field-direction/api/sdcflows.workflows.fit.fieldmap.html">fix/field-direction</a></dd>
            <dd><a href="../../fix_memory-issues-194/api/sdcflows.workflows.fit.fieldmap.html">fix/memory-issues-194</a></dd>
            <dd><a href="../../fix_topup-coeff-scaling/api/sdcflows.workflows.fit.fieldmap.html">fix/topup-coeff-scaling</a></dd>
            <dd><a href="../../maint_1.0.x/index.html">maint/1.0.x</a></dd>
            <dd><a href="../../maint_1.2.x/index.html">maint/1.2.x</a></dd>
            <dd><a href="../../maint_1.3.x/index.html">maint/1.3.x</a></dd>
            <dd><a href="../../maint_travis-gh-action-migration/index.html">maint/travis-gh-action-migration</a></dd>
            <dd><a href="../../master/api/sdcflows.workflows.fit.fieldmap.html">master</a></dd>
            <dd><a href="../../rel_2.0.0/api/sdcflows.workflows.fit.fieldmap.html">rel/2.0.0</a></dd>
            <dd><a href="../../rel_2.0.0rc3/api/sdcflows.workflows.fit.fieldmap.html">rel/2.0.0rc3</a></dd>
        </dl>
    </div>
</div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>